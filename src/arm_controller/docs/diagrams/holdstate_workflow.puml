@startuml HoldState_Workflow
!theme plain
title 钩子状态工作流程

skinparam backgroundColor #FFFFFF
skinparam defaultFontSize 12

start

:当前模式运行中
Current Mode Running;

:接收切换请求
Receive Mode Switch Request;

:退出当前模式
Exit Current Mode;

:进入钩子状态
Enter HoldState;

if (从位置控制切换?\nFrom Position Control?) then (是)
  :位置保持策略
  Position Hold Strategy;

  :锁定当前位置
  Lock Current Position;

  :持续发送位置命令
  Keep Sending Position;

  note right
    适用于:
    • MoveJ
    • MoveL
    • MoveC
  end note
else (否)
  :速度保持策略
  Velocity Hold Strategy;

  :发送零速度命令
  Send Zero Velocity;

  :等待完全停止
  Wait Until Stopped;

  note right
    适用于:
    • JointVelocity
    • CartesianVelocity
  end note
endif

:安全条件检查
Safety Condition Check;

note right
  超时时间: 10秒
  检查频率: 100ms
end note

repeat
  if (机器人已停止?\nRobot Stopped?) then (否)
    :继续等待
    Keep Waiting;
  elseif (关节在限位内?\nJoints Within Limits?) then (否)
    :继续等待
    Keep Waiting;
  elseif (系统健康?\nSystem Healthy?) then (否)
    :继续等待
    Keep Waiting;
  else (是)
    :所有条件满足
    All Conditions Met;
    break
  endif
repeat while (检查条件) is (未满足)

:退出钩子状态
Exit HoldState;

:进入目标模式
Enter Target Mode;

stop

@enduml

